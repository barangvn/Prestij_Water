<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Su Arıtma Takip Sistemi</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; }
    header { background: #0099cc; color: white; padding: 1rem; text-align: center; }

    .tab-buttons {
      display: none;
      justify-content: space-around;
      background-color: #eee;
    }
    .tab-buttons button {
      flex: 1;
      padding: 1rem;
      border: none;
      background: #eee;
      font-weight: bold;
    }
    .tab-buttons button.active {
      background-color: #0099cc;
      color: white;
    }

    .container {
      display: flex;
      height: calc(100vh - 60px);
    }
    .panel {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      border: 1px solid #ccc;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .tab-buttons {
        display: flex;
      }
      .panel {
        display: none;
        height: auto;
      }
      .panel.active {
        display: block;
      }
    }

    .section {
      margin-bottom: 1rem;
    }
    .section h3 {
      margin-bottom: 0.5rem;
    }
    label {
      display: block;
      margin: 0.5rem 0 0.25rem;
    }
    input, select, button {
      padding: 0.5rem;
      width: 100%;
      margin-bottom: 0.5rem;
    }
    ul { list-style: none; margin-top: 1rem; }
    li { padding: 0.5rem; border-bottom: 1px solid #ccc; }
    .history-btn { margin-top: 0.5rem; background: #f0ad4e; color: white; }
  </style>
</head>
<body>
  <header>
    <h1>Su Arıtma Takip Sistemi</h1>
  </header>

  <div class="tab-buttons">
    <button id="btnCustomers" class="active">Müşteriler</button>
    <button id="btnStock">Stoklar</button>
  </div>

  <div class="container">
    <!-- Müşteriler Paneli -->
    <div id="customerPanel" class="panel active">
      <div class="section">
        <h3>Yeni Müşteri Ekle</h3>
        <label>İsim</label>
        <input type="text" id="customerName" />
        <label>Telefon</label>
        <input type="text" id="customerPhone" />
        <button onclick="addCustomer()">Ekle</button>
      </div>

      <div class="section">
        <h3>Müşteri Listesi</h3>
        <ul id="customerList"></ul>
      </div>
    </div>

    <!-- Stok Paneli -->
    <div id="stockPanel" class="panel">
      <div class="section">
        <h3>Yeni Ürün Ekle</h3>
        <label>Ürün Adı</label>
        <input type="text" id="productName" />
        <label>Adet</label>
        <input type="number" id="productQuantity" />
        <label>Kritik Stok Miktarı</label>
        <input type="number" id="productCritical" />
        <button onclick="addProduct()">Ürün Ekle</button>
      </div>

      <div class="section">
        <h3>Stok Listesi</h3>
        <ul id="productList"></ul>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAmW3qdlm49cvfVeP27DaAMGJwtKDJ6kyI",
      authDomain: "prestij-water.firebaseapp.com",
      databaseURL: "https://prestij-water-default-rtdb.firebaseio.com",
      projectId: "prestij-water",
      storageBucket: "prestij-water.firebasestorage.app",
      messagingSenderId: "712467125722",
      appId: "1:712467125722:web:e845679e5d456fda2f5ce3",
      measurementId: "G-G0ZYR03RVL"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Müşteri Ekleme
    window.addCustomer = function () {
      const name = document.getElementById("customerName").value;
      const phone = document.getElementById("customerPhone").value;
      if (!name || !phone) return;
      const customerRef = push(ref(db, "customers"));
      set(customerRef, { name, phone, history: [] });
      document.getElementById("customerName").value = "";
      document.getElementById("customerPhone").value = "";
    }

    // Ürün Ekleme
    window.addProduct = function () {
      const name = document.getElementById("productName").value;
      const quantity = parseInt(document.getElementById("productQuantity").value);
      const critical = parseInt(document.getElementById("productCritical").value);
      if (!name || isNaN(quantity) || isNaN(critical)) return;
      const productRef = push(ref(db, "products"));
      set(productRef, { name, quantity, critical });
      document.getElementById("productName").value = "";
      document.getElementById("productQuantity").value = "";
      document.getElementById("productCritical").value = "";
    }

    // Listeleme
    const customerList = document.getElementById("customerList");
    onValue(ref(db, "customers"), snapshot => {
      customerList.innerHTML = "";
      snapshot.forEach(child => {
        const c = child.val();
        const li = document.createElement("li");
        li.innerHTML = `<strong>${c.name}</strong> (${c.phone})<br><button class='history-btn'>Geçmiş</button>`;
        customerList.appendChild(li);
      });
    });

    const productList = document.getElementById("productList");
    onValue(ref(db, "products"), snapshot => {
      productList.innerHTML = "";
      snapshot.forEach(child => {
        const p = child.val();
        const li = document.createElement("li");
        const warn = p.quantity <= p.critical ? "<span style='color:red'>(Kritik!)</span>" : "";
        li.innerHTML = `${p.name} - ${p.quantity} adet ${warn}`;
        productList.appendChild(li);
      });
    });

    // Sekme kontrolü (mobil)
    document.getElementById("btnCustomers").onclick = () => {
      document.getElementById("btnCustomers").classList.add("active");
      document.getElementById("btnStock").classList.remove("active");
      document.getElementById("customerPanel").classList.add("active");
      document.getElementById("stockPanel").classList.remove("active");
    }
    document.getElementById("btnStock").onclick = () => {
      document.getElementById("btnCustomers").classList.remove("active");
      document.getElementById("btnStock").classList.add("active");
      document.getElementById("customerPanel").classList.remove("active");
      document.getElementById("stockPanel").classList.add("active");
    }
  </script>
</body>
</html>
